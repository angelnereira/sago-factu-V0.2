==============================================
  ARCHIVOS CLAVE DEL PROYECTO SAGO-FACTU
==============================================

ğŸ“ UBICACIÃ“N: /home/angel-nereira/projects/UbicSystem/sago-factu

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
1. SCHEMA DE BASE DE DATOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Archivo: prisma/schema.prisma
LÃ­neas: ~400
Provider: PostgreSQL (Neon)

Modelos principales:
- Organization (multi-tenancy)
- User (con roles)
- FolioPool, FolioAssignment, FolioConsumption
- Invoice, InvoiceItem, InvoiceLog
- ApiKey, Notification, AuditLog, SystemConfig

Total tablas: 14
Total Ã­ndices: 40+
Total relaciones: 25+

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2. CLIENTES PRISMA (CRÃTICO)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

A) lib/prisma-server.ts (Para Server Actions)
   - PrismaClient bÃ¡sico SIN extensiones
   - Usado en: signup, signin, auth
   - Estado: âœ… Correcto

B) lib/prisma.ts (Para Queries)
   - PrismaClient CON extensiones
   - Extensiones: Accelerate, Pagination, Field Encryption
   - Usado en: Dashboards, listados
   - Estado: âš ï¸  Puede causar conflictos

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
3. AUTENTICACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

lib/auth.ts
- NextAuth.js v5
- Strategy: JWT
- Provider: Credentials
- Usa: prismaServer âœ…

app/api/auth/[...nextauth]/route.ts
- Handlers de NextAuth
- Export: GET, POST

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
4. PÃGINAS DE AUTH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

A) app/auth/signup/page.tsx (PROBLEMÃTICO âŒ)
   - Server Action: handleSignUp
   - Cliente Prisma: prismaServer âœ…
   - Error: Entra al catch y redirige con ServerError
   - Logs agregados: SÃ­, detallados

B) app/auth/signin/page.tsx (FUNCIONA âœ…)
   - Server Action: handleSignIn
   - Cliente Prisma: No usa directamente
   - Usa: signIn() de NextAuth

C) app/test-signup/page.tsx (NUEVO, PARA DEBUG)
   - Server Action: testSignUp
   - Logging extremadamente detallado
   - URL: /test-signup

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
5. SCRIPTS DE TESTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

A) scripts/test-signup-direct.js (FUNCIONA âœ…)
   - Usa: PrismaClient bÃ¡sico
   - Crea usuario directamente en BD
   - Resultado: Exitoso

B) scripts/test-signup-form.js
   - EnvÃ­a HTTP POST a /auth/signup
   - Simula form submission
   - Resultado: Timeout (no response)

C) scripts/diagnose-neon.js
   - Verifica conexiÃ³n a BD
   - Lista usuarios, tablas
   - Resultado: Todo OK âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
6. VARIABLES DE ENTORNO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Archivo: .env

DATABASE_URL="postgresql://neondb_owner:***@ep-divine-field-ad26eaav-pooler.c-2.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require"

NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="your-secret-key-here"

# Opcional
ENCRYPTION_KEY="" (vacÃ­o, extension deshabilitada)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
7. CONFIGURACIÃ“N NEXT.JS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

next.config.js:
- serverExternalPackages: ['@prisma/client', 'bcryptjs']
- experimental: { serverActions: true }

middleware.ts:
- Rutas pÃºblicas: /auth/*, /api/auth/*
- TamaÃ±o: 33.8 KB âœ… (< 1MB lÃ­mite)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
8. DEPENDENCIAS CRÃTICAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

next: 15.5.6
react: 19.1.0
@prisma/client: 6.17.1
@prisma/extension-accelerate: 2.0.2
prisma-extension-pagination: 0.7.5
prisma-field-encryption: 1.6.0
next-auth: 5.0.0-beta.29
bcryptjs: 3.0.2

Node: v18.19.1
npm: 9.2.0

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
9. ESTADO DE BUILD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

npm run build: âœ… EXITOSO
TypeScript: âœ… Sin errores
Middleware: âœ… 33.8 KB (dentro del lÃ­mite)
Prisma Client: âœ… Generado

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
10. ESTADO DE BASE DE DATOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ConexiÃ³n: âœ… Exitosa
Proveedor: PostgreSQL (Neon Serverless)
RegiÃ³n: us-east-1
Tipo: Pooled connection

Usuarios en BD:
1. admin@sagofactu.com (Super Admin) âœ…
2. usuario@empresa.com (Usuario Demo) âœ…
3. angelnereira15@gmail.com (Usuario) âœ…
4. test-1761078920899@ejemplo.com (Test) âœ…

Organizaciones:
1. empresa-demo (Empresa Demo S.A.) âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
11. LOGS DEL SERVIDOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

UbicaciÃ³n: /tmp/sago-dev.log

Ãšltima ejecuciÃ³n:
âœ“ Starting...
âœ“ Compiled middleware in 370ms
âœ“ Ready in 2s
â—‹ Compiling /auth/signup ...
âœ“ Compiled /auth/signup in 4.7s
POST /auth/signup 200 in 5159ms

âš ï¸  El POST retorna 200 pero no hay logs de la funciÃ³n

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
12. RUTAS DE LA APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/ ........................ Home (estÃ¡tica)
/auth/signin ............. Login âœ…
/auth/signup ............. Registro âŒ
/dashboard ............... Dashboard (protegido)
/test-signup ............. Test de registro (debug)

API Routes:
/api/auth/[...nextauth] .. NextAuth handlers âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
13. ÃšLTIMOS COMMITS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

a6a6f88 - fix: Separar clientes Prisma
df1b7ab - docs: Resumen completo
37a7ca8 - fix: Errores TypeScript
7a535a1 - feat: Optimizaciones Prisma

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
14. URLs DEL PROYECTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Desarrollo:  http://localhost:3000
ProducciÃ³n:  https://sago-factu.vercel.app
Repositorio: https://github.com/angelnereira/sago-factu-V0.2
Test:        http://localhost:3000/test-signup

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

GENERADO: 21 de Octubre, 2025
PARA: Integrador TÃ©cnico
POR: Equipo SAGO-FACTU

